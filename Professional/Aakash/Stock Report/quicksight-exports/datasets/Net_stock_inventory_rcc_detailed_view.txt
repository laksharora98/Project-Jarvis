select tp.*,case when substring(tp.material_id,1,1)='9' then 'Starting with 9' else 'Not Starting with 9' end materialnumberstartwith9,
mm.material_description,
CASE
        WHEN mm.serial_number_profile = '0005' THEN 'Bar-Coded'
        ELSE 'Non Bar-Coded'
    END AS Material_type

    from  (SELECT 
    E.region_disp_val,
    D.business_unit_type_disp_val,
    A.business_area_key as business_unit,
    SUBSTR(A.business_area_key, 3, 3) AS CODE,
    A.business_area_desc,
    A.status,
    A.sap_plant_id,
 F.material_id,
F.BARCODE
FROM
     "phoenix-master_setup_service".business_area_master A
        INNER JOIN
     "phoenix-master_setup_service".business_area_region_master B ON A.id = B.business_area_id
        INNER JOIN
     "phoenix-master_setup_service".business_area_business_unit_type_master C ON A.id = C.business_area_id
        INNER JOIN
     "phoenix-master_setup_service".business_unit_type_master D ON C.business_unit_type_id = D.ID
        INNER JOIN
    "phoenix-master_setup_service".region_master E ON  cast(B.region_id as varchar(50)) = cast(E.region_key as varchar(50))
        INNER JOIN
    "phoenix-enrollment_service".material_grn_numbers F ON F.plant_id = A.sap_plant_id
WHERE
F.is_deleted = 0
        AND F.STATUS = 'ACTIVE' and A.business_area_key not in ('DW005','IC006','DW007')
        AND F.is_consumed = 0
       ) tp
       inner join (select material_id,material_description,serial_number_profile from (select material_id,material_description ,serial_number_profile,row_number() over(partition by material_id order by updated_on desc) rn  from "phoenix-enrollment_service".material_master ) where rn=1)  mm
on mm.material_id=tp.material_id